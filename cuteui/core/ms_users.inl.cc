
#include <stdafx.h>
#include "ms_users.h"

//use ungzip
#include <zlib.h>
#include <net/net.h>

unsigned char ms_file_flags[4] = {
	0x0D, 0x0F, 0x3E, 0x03
};

uint8 ms_xor_table[] = {
	0x1B, 0x3F, 0x30, 0x14, 0x2D, 0x0A, 0x01, 0x32,
	0x2F, 0x16, 0x26, 0x06, 0x1D, 0x1B, 0x04, 0x20,
	0x3F, 0x35, 0x02, 0x05, 0x3C, 0x30, 0x0C, 0x34,
	0x2C, 0x35, 0x03, 0x07, 0x37, 0x39, 0x19, 0x10,
	0x2F, 0x28, 0x06, 0x06, 0x3B, 0x35, 0x11, 0x31,
	0x26, 0x3B, 0x0E, 0x09, 0x3D, 0x37, 0x01, 0x34,
	0x32, 0x12, 0x05, 0x29, 0x3F, 0x27, 0x13, 0x14,
	0x36, 0x1E, 0x05, 0x00, 0x2D, 0x1D, 0x33, 0x0D,
	0x19, 0x37, 0x01, 0x39, 0x2F, 0x0F, 0x30, 0x21,
	0x1B, 0x3F, 0x18, 0x09, 0x0A, 0x19, 0x32, 0x01,
	0x1D, 0x3D, 0x08, 0x28, 0x1E, 0x1E, 0x16, 0x0A,
	0x2D, 0x3B, 0x20, 0x38, 0x12, 0x2E, 0x26, 0x08,
	0x35, 0x2F, 0x10, 0x1C, 0x23, 0x36, 0x22, 0x08,
	0x1E, 0x0F, 0x12, 0x14, 0x33, 0x2F, 0x0E, 0x0A,
	0x3B, 0x2E, 0x32, 0x12, 0x0F, 0x2F, 0x04, 0x1A,
	0x12, 0x1C, 0x20, 0x06, 0x3D, 0x3F, 0x2D, 0x02,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

uint8 ms_6928BC_table[] = {
	0x00, 0x04, 0x01, 0x01,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00,
	0x04, 0x04, 0x01, 0x01, 0x04, 0x00, 0x01, 0x01,
	0x04, 0x04, 0x01, 0x00, 0x04, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x01, 0x00, 0x00, 0x04, 0x00, 0x00,
	0x00, 0x04, 0x01, 0x01, 0x04, 0x04, 0x01, 0x01,
	0x00, 0x04, 0x00, 0x00, 0x04, 0x04, 0x00, 0x01,
	0x04, 0x00, 0x01, 0x01, 0x00, 0x00, 0x00, 0x01,
	0x04, 0x00, 0x00, 0x00, 0x04, 0x04, 0x00, 0x00,
	0x00, 0x04, 0x00, 0x01, 0x00, 0x04, 0x00, 0x01,
	0x00, 0x04, 0x01, 0x00, 0x00, 0x04, 0x01, 0x00,
	0x00, 0x00, 0x01, 0x01, 0x00, 0x00, 0x01, 0x01,
	0x04, 0x04, 0x00, 0x01, 0x04, 0x00, 0x01, 0x00,
	0x04, 0x00, 0x00, 0x01, 0x04, 0x00, 0x00, 0x01,
	0x04, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x04, 0x04, 0x00, 0x00, 0x04, 0x04, 0x01, 0x00,
	0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x01, 0x00,
	0x04, 0x04, 0x01, 0x01, 0x04, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x01, 0x01, 0x00, 0x04, 0x01, 0x01,
	0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01,
	0x00, 0x04, 0x00, 0x00, 0x04, 0x00, 0x01, 0x01,
	0x00, 0x00, 0x01, 0x00, 0x00, 0x04, 0x01, 0x00,
	0x04, 0x00, 0x00, 0x01, 0x00, 0x04, 0x00, 0x00,
	0x04, 0x00, 0x00, 0x00, 0x04, 0x04, 0x00, 0x01,
	0x04, 0x04, 0x01, 0x00, 0x04, 0x04, 0x01, 0x01,
	0x04, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01, 0x01,
	0x04, 0x04, 0x00, 0x01, 0x04, 0x00, 0x00, 0x01,
	0x04, 0x04, 0x00, 0x00, 0x04, 0x04, 0x01, 0x00,
	0x00, 0x04, 0x01, 0x01, 0x04, 0x04, 0x00, 0x00,
	0x00, 0x04, 0x00, 0x01, 0x00, 0x04, 0x00, 0x01,
	0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x01, 0x00,
	0x00, 0x04, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x04, 0x00, 0x01, 0x01, 0x20, 0x80, 0x10, 0x80,
	0x00, 0x80, 0x00, 0x80, 0x00, 0x80, 0x00, 0x00,
	0x20, 0x80, 0x10, 0x00, 0x00, 0x00, 0x10, 0x00,
	0x20, 0x00, 0x00, 0x00, 0x20, 0x00, 0x10, 0x80,
	0x20, 0x80, 0x00, 0x80, 0x20, 0x00, 0x00, 0x80,
	0x20, 0x80, 0x10, 0x80, 0x00, 0x80, 0x10, 0x80,
	0x00, 0x00, 0x00, 0x80, 0x00, 0x80, 0x00, 0x80,
	0x00, 0x00, 0x10, 0x00, 0x20, 0x00, 0x00, 0x00,
	0x20, 0x00, 0x10, 0x80, 0x00, 0x80, 0x10, 0x00,
	0x20, 0x00, 0x10, 0x00, 0x20, 0x80, 0x00, 0x80,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80,
	0x00, 0x80, 0x00, 0x00, 0x20, 0x80, 0x10, 0x00,
	0x00, 0x00, 0x10, 0x80, 0x20, 0x00, 0x10, 0x00,
	0x20, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x80, 0x10, 0x00, 0x20, 0x80, 0x00, 0x00,
	0x00, 0x80, 0x10, 0x80, 0x00, 0x00, 0x10, 0x80,
	0x20, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x20, 0x80, 0x10, 0x00, 0x20, 0x00, 0x10, 0x80,
	0x00, 0x00, 0x10, 0x00, 0x20, 0x80, 0x00, 0x80,
	0x00, 0x00, 0x10, 0x80, 0x00, 0x80, 0x10, 0x80,
	0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x10, 0x80,
	0x00, 0x80, 0x00, 0x80, 0x20, 0x00, 0x00, 0x00,
	0x20, 0x80, 0x10, 0x80, 0x20, 0x80, 0x10, 0x00,
	0x20, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x80, 0x20, 0x80, 0x00, 0x00,
	0x00, 0x80, 0x10, 0x80, 0x00, 0x00, 0x10, 0x00,
	0x20, 0x00, 0x00, 0x80, 0x20, 0x00, 0x10, 0x00,
	0x20, 0x80, 0x00, 0x80, 0x20, 0x00, 0x00, 0x80,
	0x20, 0x00, 0x10, 0x00, 0x00, 0x80, 0x10, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x80,
	0x20, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80,
	0x20, 0x00, 0x10, 0x80, 0x20, 0x80, 0x10, 0x80,
	0x00, 0x80, 0x10, 0x00, 0x08, 0x02, 0x00, 0x00,
	0x00, 0x02, 0x02, 0x08, 0x00, 0x00, 0x00, 0x00,
	0x08, 0x00, 0x02, 0x08, 0x00, 0x02, 0x00, 0x08,
	0x00, 0x00, 0x00, 0x00, 0x08, 0x02, 0x02, 0x00,
	0x00, 0x02, 0x00, 0x08, 0x08, 0x00, 0x02, 0x00,
	0x08, 0x00, 0x00, 0x08, 0x08, 0x00, 0x00, 0x08,
	0x00, 0x00, 0x02, 0x00, 0x08, 0x02, 0x02, 0x08,
	0x08, 0x00, 0x02, 0x00, 0x00, 0x00, 0x02, 0x08,
	0x08, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08,
	0x08, 0x00, 0x00, 0x00, 0x00, 0x02, 0x02, 0x08,
	0x00, 0x02, 0x00, 0x00, 0x00, 0x02, 0x02, 0x00,
	0x00, 0x00, 0x02, 0x08, 0x08, 0x00, 0x02, 0x08,
	0x08, 0x02, 0x02, 0x00, 0x08, 0x02, 0x00, 0x08,
	0x00, 0x02, 0x02, 0x00, 0x00, 0x00, 0x02, 0x00,
	0x08, 0x02, 0x00, 0x08, 0x08, 0x00, 0x00, 0x00,
	0x08, 0x02, 0x02, 0x08, 0x00, 0x02, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x08, 0x00, 0x02, 0x02, 0x08,
	0x00, 0x00, 0x00, 0x08, 0x08, 0x00, 0x02, 0x00,
	0x08, 0x02, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00,
	0x00, 0x02, 0x02, 0x08, 0x00, 0x02, 0x00, 0x08,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00,
	0x08, 0x00, 0x02, 0x00, 0x08, 0x02, 0x02, 0x08,
	0x00, 0x02, 0x00, 0x08, 0x08, 0x00, 0x00, 0x08,
	0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x08, 0x00, 0x02, 0x08, 0x08, 0x02, 0x00, 0x08,
	0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x08,
	0x08, 0x02, 0x02, 0x08, 0x08, 0x00, 0x00, 0x00,
	0x08, 0x02, 0x02, 0x00, 0x00, 0x02, 0x02, 0x00,
	0x08, 0x00, 0x00, 0x08, 0x00, 0x00, 0x02, 0x08,
	0x08, 0x02, 0x00, 0x08, 0x08, 0x02, 0x00, 0x00,
	0x00, 0x00, 0x02, 0x08, 0x08, 0x02, 0x02, 0x00,
	0x08, 0x00, 0x00, 0x00, 0x08, 0x00, 0x02, 0x08,
	0x00, 0x02, 0x02, 0x00, 0x01, 0x20, 0x80, 0x00,
	0x81, 0x20, 0x00, 0x00, 0x81, 0x20, 0x00, 0x00,
	0x80, 0x00, 0x00, 0x00, 0x80, 0x20, 0x80, 0x00,
	0x81, 0x00, 0x80, 0x00, 0x01, 0x00, 0x80, 0x00,
	0x01, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x20, 0x80, 0x00, 0x00, 0x20, 0x80, 0x00,
	0x81, 0x20, 0x80, 0x00, 0x81, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x80, 0x00,
	0x01, 0x00, 0x80, 0x00, 0x01, 0x00, 0x00, 0x00,
	0x00, 0x20, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00,
	0x01, 0x20, 0x80, 0x00, 0x80, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x80, 0x00, 0x01, 0x20, 0x00, 0x00,
	0x80, 0x20, 0x00, 0x00, 0x81, 0x00, 0x80, 0x00,
	0x01, 0x00, 0x00, 0x00, 0x80, 0x20, 0x00, 0x00,
	0x80, 0x00, 0x80, 0x00, 0x00, 0x20, 0x00, 0x00,
	0x80, 0x20, 0x80, 0x00, 0x81, 0x20, 0x80, 0x00,
	0x81, 0x00, 0x00, 0x00, 0x80, 0x00, 0x80, 0x00,
	0x01, 0x00, 0x80, 0x00, 0x00, 0x20, 0x80, 0x00,
	0x81, 0x20, 0x80, 0x00, 0x81, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x20, 0x80, 0x00, 0x80, 0x20, 0x00, 0x00,
	0x80, 0x00, 0x80, 0x00, 0x81, 0x00, 0x80, 0x00,
	0x01, 0x00, 0x00, 0x00, 0x01, 0x20, 0x80, 0x00,
	0x81, 0x20, 0x00, 0x00, 0x81, 0x20, 0x00, 0x00,
	0x80, 0x00, 0x00, 0x00, 0x81, 0x20, 0x80, 0x00,
	0x81, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00,
	0x00, 0x20, 0x00, 0x00, 0x01, 0x00, 0x80, 0x00,
	0x01, 0x20, 0x00, 0x00, 0x80, 0x20, 0x80, 0x00,
	0x81, 0x00, 0x80, 0x00, 0x01, 0x20, 0x00, 0x00,
	0x80, 0x20, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00,
	0x01, 0x20, 0x80, 0x00, 0x80, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x80, 0x00, 0x00, 0x20, 0x00, 0x00,
	0x80, 0x20, 0x80, 0x00, 0x00, 0x01, 0x00, 0x00,
	0x00, 0x01, 0x08, 0x02, 0x00, 0x00, 0x08, 0x02,
	0x00, 0x01, 0x00, 0x42, 0x00, 0x00, 0x08, 0x00,
	0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40,
	0x00, 0x00, 0x08, 0x02, 0x00, 0x01, 0x08, 0x40,
	0x00, 0x00, 0x08, 0x00, 0x00, 0x01, 0x00, 0x02,
	0x00, 0x01, 0x08, 0x40, 0x00, 0x01, 0x00, 0x42,
	0x00, 0x00, 0x08, 0x42, 0x00, 0x01, 0x08, 0x00,
	0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x02,
	0x00, 0x00, 0x08, 0x40, 0x00, 0x00, 0x08, 0x40,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x40,
	0x00, 0x01, 0x08, 0x42, 0x00, 0x01, 0x08, 0x42,
	0x00, 0x01, 0x00, 0x02, 0x00, 0x00, 0x08, 0x42,
	0x00, 0x01, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x42, 0x00, 0x01, 0x08, 0x02,
	0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x42,
	0x00, 0x01, 0x08, 0x00, 0x00, 0x00, 0x08, 0x00,
	0x00, 0x01, 0x00, 0x42, 0x00, 0x01, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x40,
	0x00, 0x00, 0x08, 0x02, 0x00, 0x01, 0x00, 0x42,
	0x00, 0x01, 0x08, 0x40, 0x00, 0x01, 0x00, 0x02,
	0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x08, 0x42,
	0x00, 0x01, 0x08, 0x02, 0x00, 0x01, 0x08, 0x40,
	0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02,
	0x00, 0x00, 0x08, 0x42, 0x00, 0x01, 0x08, 0x42,
	0x00, 0x01, 0x08, 0x00, 0x00, 0x00, 0x00, 0x42,
	0x00, 0x01, 0x08, 0x42, 0x00, 0x00, 0x08, 0x02,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x40,
	0x00, 0x00, 0x00, 0x42, 0x00, 0x01, 0x08, 0x00,
	0x00, 0x01, 0x00, 0x02, 0x00, 0x01, 0x00, 0x40,
	0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x08, 0x40, 0x00, 0x01, 0x08, 0x02,
	0x00, 0x01, 0x00, 0x40, 0x10, 0x00, 0x00, 0x20,
	0x00, 0x00, 0x40, 0x20, 0x00, 0x40, 0x00, 0x00,
	0x10, 0x40, 0x40, 0x20, 0x00, 0x00, 0x40, 0x20,
	0x10, 0x00, 0x00, 0x00, 0x10, 0x40, 0x40, 0x20,
	0x00, 0x00, 0x40, 0x00, 0x00, 0x40, 0x00, 0x20,
	0x10, 0x40, 0x40, 0x00, 0x00, 0x00, 0x40, 0x00,
	0x10, 0x00, 0x00, 0x20, 0x10, 0x00, 0x40, 0x00,
	0x00, 0x40, 0x00, 0x20, 0x00, 0x00, 0x00, 0x20,
	0x10, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x10, 0x00, 0x40, 0x00, 0x10, 0x40, 0x00, 0x20,
	0x00, 0x40, 0x00, 0x00, 0x00, 0x40, 0x40, 0x00,
	0x10, 0x40, 0x00, 0x20, 0x10, 0x00, 0x00, 0x00,
	0x10, 0x00, 0x40, 0x20, 0x10, 0x00, 0x40, 0x20,
	0x00, 0x00, 0x00, 0x00, 0x10, 0x40, 0x40, 0x00,
	0x00, 0x40, 0x40, 0x20, 0x10, 0x40, 0x00, 0x00,
	0x00, 0x40, 0x40, 0x00, 0x00, 0x40, 0x40, 0x20,
	0x00, 0x00, 0x00, 0x20, 0x00, 0x40, 0x00, 0x20,
	0x10, 0x00, 0x00, 0x00, 0x10, 0x00, 0x40, 0x20,
	0x00, 0x40, 0x40, 0x00, 0x10, 0x40, 0x40, 0x20,
	0x00, 0x00, 0x40, 0x00, 0x10, 0x40, 0x00, 0x00,
	0x10, 0x00, 0x00, 0x20, 0x00, 0x00, 0x40, 0x00,
	0x00, 0x40, 0x00, 0x20, 0x00, 0x00, 0x00, 0x20,
	0x10, 0x40, 0x00, 0x00, 0x10, 0x00, 0x00, 0x20,
	0x10, 0x40, 0x40, 0x20, 0x00, 0x40, 0x40, 0x00,
	0x00, 0x00, 0x40, 0x20, 0x10, 0x40, 0x40, 0x00,
	0x00, 0x40, 0x40, 0x20, 0x00, 0x00, 0x00, 0x00,
	0x10, 0x00, 0x40, 0x20, 0x10, 0x00, 0x00, 0x00,
	0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x40, 0x20,
	0x10, 0x40, 0x40, 0x00, 0x00, 0x40, 0x00, 0x00,
	0x10, 0x00, 0x40, 0x00, 0x10, 0x40, 0x00, 0x20,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x40, 0x20,
	0x00, 0x00, 0x00, 0x20, 0x10, 0x00, 0x40, 0x00,
	0x10, 0x40, 0x00, 0x20, 0x00, 0x00, 0x20, 0x00,
	0x02, 0x00, 0x20, 0x04, 0x02, 0x08, 0x00, 0x04,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00,
	0x02, 0x08, 0x00, 0x04, 0x02, 0x08, 0x20, 0x00,
	0x00, 0x08, 0x20, 0x04, 0x02, 0x08, 0x20, 0x04,
	0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x02, 0x00, 0x00, 0x04, 0x02, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x04, 0x02, 0x00, 0x20, 0x04,
	0x02, 0x08, 0x00, 0x00, 0x00, 0x08, 0x00, 0x04,
	0x02, 0x08, 0x20, 0x00, 0x02, 0x00, 0x20, 0x00,
	0x00, 0x08, 0x00, 0x04, 0x02, 0x00, 0x00, 0x04,
	0x00, 0x00, 0x20, 0x04, 0x00, 0x08, 0x20, 0x04,
	0x02, 0x00, 0x20, 0x00, 0x00, 0x00, 0x20, 0x04,
	0x00, 0x08, 0x00, 0x00, 0x02, 0x08, 0x00, 0x00,
	0x02, 0x08, 0x20, 0x04, 0x00, 0x08, 0x20, 0x00,
	0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04,
	0x00, 0x08, 0x20, 0x00, 0x00, 0x00, 0x00, 0x04,
	0x00, 0x08, 0x20, 0x00, 0x00, 0x00, 0x20, 0x00,
	0x02, 0x08, 0x00, 0x04, 0x02, 0x08, 0x00, 0x04,
	0x02, 0x00, 0x20, 0x04, 0x02, 0x00, 0x20, 0x04,
	0x02, 0x00, 0x00, 0x00, 0x02, 0x00, 0x20, 0x00,
	0x00, 0x00, 0x00, 0x04, 0x00, 0x08, 0x00, 0x04,
	0x00, 0x00, 0x20, 0x00, 0x00, 0x08, 0x20, 0x04,
	0x02, 0x08, 0x00, 0x00, 0x02, 0x08, 0x20, 0x00,
	0x00, 0x08, 0x20, 0x04, 0x02, 0x08, 0x00, 0x00,
	0x02, 0x00, 0x00, 0x04, 0x02, 0x08, 0x20, 0x04,
	0x00, 0x00, 0x20, 0x04, 0x00, 0x08, 0x20, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00,
	0x02, 0x08, 0x20, 0x04, 0x00, 0x00, 0x00, 0x00,
	0x02, 0x08, 0x20, 0x00, 0x00, 0x00, 0x20, 0x04,
	0x00, 0x08, 0x00, 0x00, 0x02, 0x00, 0x00, 0x04,
	0x00, 0x08, 0x00, 0x04, 0x00, 0x08, 0x00, 0x00,
	0x02, 0x00, 0x20, 0x00, 0x40, 0x10, 0x00, 0x10,
	0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00,
	0x40, 0x10, 0x04, 0x10, 0x00, 0x00, 0x00, 0x10,
	0x40, 0x10, 0x00, 0x10, 0x40, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x10, 0x40, 0x00, 0x04, 0x00,
	0x00, 0x00, 0x04, 0x10, 0x40, 0x10, 0x04, 0x10,
	0x00, 0x10, 0x04, 0x00, 0x00, 0x10, 0x04, 0x10,
	0x40, 0x10, 0x04, 0x00, 0x00, 0x10, 0x00, 0x00,
	0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x10,
	0x40, 0x00, 0x00, 0x10, 0x00, 0x10, 0x00, 0x10,
	0x40, 0x10, 0x00, 0x00, 0x00, 0x10, 0x04, 0x00,
	0x40, 0x00, 0x04, 0x00, 0x40, 0x00, 0x04, 0x10,
	0x00, 0x10, 0x04, 0x10, 0x40, 0x10, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x40, 0x00, 0x04, 0x10, 0x40, 0x00, 0x00, 0x10,
	0x00, 0x10, 0x00, 0x10, 0x40, 0x10, 0x04, 0x00,
	0x00, 0x00, 0x04, 0x00, 0x40, 0x10, 0x04, 0x00,
	0x00, 0x00, 0x04, 0x00, 0x00, 0x10, 0x04, 0x10,
	0x00, 0x10, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00,
	0x40, 0x00, 0x04, 0x10, 0x00, 0x10, 0x00, 0x00,
	0x40, 0x10, 0x04, 0x00, 0x00, 0x10, 0x00, 0x10,
	0x40, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x10,
	0x00, 0x00, 0x04, 0x10, 0x40, 0x00, 0x04, 0x10,
	0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x04, 0x00,
	0x40, 0x10, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00,
	0x40, 0x10, 0x04, 0x10, 0x40, 0x00, 0x04, 0x00,
	0x40, 0x00, 0x00, 0x10, 0x00, 0x00, 0x04, 0x10,
	0x00, 0x10, 0x00, 0x10, 0x40, 0x10, 0x00, 0x10,
	0x00, 0x00, 0x00, 0x00, 0x40, 0x10, 0x04, 0x10,
	0x00, 0x10, 0x04, 0x00, 0x00, 0x10, 0x04, 0x00,
	0x40, 0x10, 0x00, 0x00, 0x40, 0x10, 0x00, 0x00,
	0x40, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x10,
	0x00, 0x10, 0x04, 0x10, 0x54, 0x31, 0x69, 0x00,
	0x48, 0x31, 0x69, 0x00, 0xC4, 0x01, 0x6E, 0x00,
	0x3C, 0x31, 0x69, 0x00, 0x2C, 0x31, 0x69, 0x00,
	0x20, 0x31, 0x69, 0x00, 0x0C, 0x31, 0x69, 0x00,
	0xFC, 0x30, 0x69, 0x00, 0xE4, 0x30, 0x69, 0x00,
	0xC4, 0x01, 0x6E, 0x00, 0x69, 0x6E, 0x63, 0x6F,
	0x6D, 0x70, 0x61, 0x74, 0x69, 0x62, 0x6C, 0x65,
	0x20, 0x76, 0x65, 0x72, 0x73, 0x69, 0x6F, 0x6E,
	0x00, 0x00, 0x00, 0x00, 0x62, 0x75, 0x66, 0x66,
	0x65, 0x72, 0x20, 0x65, 0x72, 0x72, 0x6F, 0x72,
	0x00, 0x00, 0x00, 0x00, 0x69, 0x6E, 0x73, 0x75,
	0x66, 0x66, 0x69, 0x63, 0x69, 0x65, 0x6E, 0x74,
	0x20, 0x6D, 0x65, 0x6D, 0x6F, 0x72, 0x79, 0x00,
	0x64, 0x61, 0x74, 0x61, 0x20, 0x65, 0x72, 0x72,
	0x6F, 0x72, 0x00, 0x00, 0x73, 0x74, 0x72, 0x65,
	0x61, 0x6D, 0x20, 0x65, 0x72, 0x72, 0x6F, 0x72,
	0x00, 0x00, 0x00, 0x00, 0x66, 0x69, 0x6C, 0x65,
	0x20, 0x65, 0x72, 0x72, 0x6F, 0x72, 0x00, 0x00,
	0x73, 0x74, 0x72, 0x65, 0x61, 0x6D, 0x20, 0x65,
	0x6E, 0x64, 0x00, 0x00, 0x6E, 0x65, 0x65, 0x64,
	0x20, 0x64, 0x69, 0x63, 0x74, 0x69, 0x6F, 0x6E,
	0x61, 0x72, 0x79, 0x00, 0x00, 0x00, 0x00, 0x00
};

inline uint32 gethe32(uint8 *data) {
	return (data[0] << 24 | data[1] << 16 | data[2] << 8 | data[3]);
}

void ms_decode8(uint8 *data)
{
	int len = 8;
	uint32 __esi, __esp;
	uint32 _eax, _edx, _edi, _ecx, _esi, _ebp, _ebx;
	_eax = gethe32(data);
	_edx = gethe32(data + 4);

	_ecx = _eax >> 4;
	_ecx &= 0x0f0f0f0f;
	_esi = _edx & 0x0f0f0f0f;

	_ecx ^= _esi;
	_edx ^= _ecx;

	_ecx <<= 4;
	_eax ^= _ecx;

	uint32 ptr_xor_table = (uint32)ms_xor_table;
	uint32 ptr_6928BC_table = (uint32)ms_6928BC_table;
	uint32 x = 8;

	__asm {
		mov __esi, ESI
		mov __esp, ESP

		mov EDX, _edx
		mov EAX, _eax

		MOV ESI,EDX
		MOV ECX,EAX
		AND ESI,0FFFFh
		SHR ECX,10h
		XOR ECX,ESI
		XOR EDX,ECX
		SHL ECX,10h
		XOR EAX,ECX
		MOV ECX,EDX
		SHR ECX,2h
		MOV ESI,EAX
		AND ECX,33333333h
		AND ESI,33333333h
		XOR ECX,ESI
		XOR EAX,ECX
		SHL ECX,2h
		XOR EDX,ECX
		MOV ESI,EAX
		MOV ECX,EDX
		AND ESI,0FF00FFh
		SHR ECX,8h
		AND ECX,0FF00FFh
		XOR ECX,ESI

		//MOV ESI,DWORD PTR SS:[ESP+1C]            ; 月光.006E0044
		MOV ESI, ptr_xor_table

		XOR EAX,ECX
		SHL ECX,8h
		XOR EDX,ECX
		MOV ECX,EDX
		ADD EDX,EDX
		SHR ECX,1Fh
		OR ECX,EDX
		MOV EDX,ECX
		XOR EDX,EAX
		AND EDX,0xAAAAAAAA
		XOR EAX,EDX
		XOR ECX,EDX
		MOV EDX,EAX
		ADD EAX,EAX
		SHR EDX,1Fh
		OR EDX,EAX

l_004FDC94:
		MOV EBX,DWORD PTR DS:[ESI]

		MOV EAX,ECX
		MOV EDI,ECX
		ADD ESI,4h
		SHL EAX,1Ch
		SHR EDI,4h
		OR EAX,EDI
		ADD ESI,4h
		XOR EAX,EBX
		ADD ESI,4h
		MOV EBX,EAX
		MOV EDI,EAX
		SHR EBX,10h
		AND EBX,3Fh
		ADD ESI,4h
		SHR EDI,18h

		mov _eax, EAX
		mov _edx, EDX
		mov _ecx, ECX
		mov _ebx, EBX
		mov _edi, EDI
		mov _esi, ESI
	}
		//MOV _ebp,DWORD PTR DS:[EBX*4+692ABC]
		_ebp = *(uint32 *)(_ebx * 4 + ms_6928BC_table + 0x200);
		_ebx = _eax;
		_edi &= 0x3F;
		_eax &= 0x3F;
		_ebx >>= 8;
		//MOV EDI,DWORD PTR DS:[EDI*4+6928BC]
		_edi = *(uint32 *)(_edi * 4 + ms_6928BC_table);
		_ebx &= 0x3F;
		_edi |= _ebp;
		//MOV _ebp,DWORD PTR DS:[EBX*4+692CBC]
		_ebp = *(uint32 *)(_ebx * 4 + ms_6928BC_table + 0x400);
		//MOV EBX,DWORD PTR DS:[EAX*4+692EBC]
		_ebx = *(uint32 *)(_eax * 4 + ms_6928BC_table + 0x600);
		//MOV EAX,DWORD PTR DS:[ESI-0xC]
		_eax = *(uint32 *)(_esi - 0xC);
		_edi |= _ebp;
		_eax ^= _ecx;
		_edi |= _ebx;
		_ebx = _eax;
		_ebp = _eax;
		_ebx >>= 0x18;
		_ebx &= 0x3F;
		_ebp >>= 0x10;

		//MOV EBX,DWORD PTR DS:[EBX*4+6929BC]
		_ebx = *(uint32 *)(_ebx * 4 + ms_6928BC_table + 0x100);
		_ebp &= 0x3f;

		//OR EBX,DWORD PTR DS:[_ebp*4+692BBC]
		_ebx |= *(uint32 *)(_ebp * 4 + ms_6928BC_table + 0x300);
		_ebp = _eax;
		_ebp >>= 8;
		_ebp &= 0x3F;
		_eax &= 0x3F;

		//OR EBX,DWORD PTR DS:[_ebp*4+692DBC]
		_ebx |= *(uint32 *)(_ebp * 4 + ms_6928BC_table + 0x500);
		//MOV _ebp,DWORD PTR DS:[EAX*4+692FBC]
		_ebp = *(uint32 *)(_eax * 4 + ms_6928BC_table + 0x700);

		_ebx |= _ebp;
		_ebx |= _edi;
		_edx ^= _ebx;

		//MOV EBX,DWORD PTR DS:[ESI-8]
		_ebx = *(uint32 *)(_esi - 0x8);
		_eax = _edx;
		_edi = _edx;
		_eax <<= 0x1C;
		_edi >>= 4;
		_eax |= _edi;
		_eax ^= _ebx;
		_ebx = _eax;
		_edi = _eax;
		_ebx >>= 0x10;
		_ebx &= 0x3F;
		_edi >>= 0x18;
		//MOV _ebp,DWORD PTR DS:[EBX*4+692ABC]
		_ebp = *(uint32 *)(_ebx * 4 + ms_6928BC_table + 0x200);
		_ebx = _eax;
		_edi &= 0x3F;
		_eax &= 0x3F;
		_ebx >>= 8;
		//MOV EDI,DWORD PTR DS:[EDI*4+6928BC]
		_edi = *(uint32 *)(_edi * 4 + ms_6928BC_table);
		_ebx &= 0x3F;
		_edi |= _ebp;
		//MOV _ebp,DWORD PTR DS:[EBX*4+692CBC]
		_ebp = *(uint32 *)(_ebx * 4 + ms_6928BC_table + 0x400);
		//MOV EBX,DWORD PTR DS:[EAX*4+692EBC]
		_ebx = *(uint32 *)(_eax * 4 + ms_6928BC_table + 0x600);
		//MOV EAX,DWORD PTR DS:[ESI-4]
		_eax = *(uint32 *)(_esi - 0x4);
		_edi |= _ebp;
		_eax ^= _edx;
		_edi |= _ebx;
		_ebx = _eax;
		_ebp = _eax;
		_ebx >>= 0x18;
		_ebx &= 0x3F;
		_ebp >>= 0x10;
		//MOV EBX,DWORD PTR DS:[EBX*4+6929BC]
		_ebx = *(uint32 *)(_ebx * 4 + ms_6928BC_table + 0x100);
		_ebp &= 0x3F;
		//OR EBX,DWORD PTR DS:[_ebp*4+692BBC]
		_ebx |= *(uint32 *)(_ebp * 4 + ms_6928BC_table + 0x300);
		_ebp = _eax;
		_eax &= 0x3F;
		_ebp >>= 8;
		_ebp &= 0x3F;
		//OR EBX,DWORD PTR DS:[_ebp*4+692DBC]
		_ebx |= *(uint32 *)(_ebp * 4 + ms_6928BC_table + 0x500);
		//MOV _ebp,DWORD PTR DS:[EAX*4+692FBC]
		_ebp = *(uint32 *)(_eax * 4 + ms_6928BC_table + 0x700);

		_ebx |= _ebp;
		_ebx |= _edi;
		_ecx ^= _ebx;

	__asm {
		//mov EAX, _eax 
		mov EDX, _edx
		mov ECX, _ecx
		mov EBX, _ebx
		mov EDI, _edi
		mov ESI, _esi 

		MOV EAX, x
		DEC EAX
		MOV x,EAX


		//^0F85 C6FEFFFF    JNZ 月光.004FDC94h
		JNZ l_004FDC94

		MOV EAX,ECX
		POP EDI
		SHL EAX,1Fh
		SHR ECX,1h
		OR EAX,ECX
		MOV ECX,EAX
		XOR ECX,EDX
		AND ECX,0xAAAAAAAA
		XOR EDX,ECX
		XOR EAX,ECX
		MOV ECX,EDX
		MOV ESI,EAX
		SHL ECX,1Fh
		SHR EDX,1h
		OR ECX,EDX
		AND ESI,0FF00FFh
		MOV EDX,ECX
		SHR EDX,8h
		AND EDX,0FF00FFh
		XOR EDX,ESI
		XOR EAX,EDX
		SHL EDX,8h
		XOR ECX,EDX
		MOV ESI,EAX
		MOV EDX,ECX
		AND ESI,33333333h
		SHR EDX,2h
		AND EDX,33333333h
		XOR EDX,ESI
		XOR EAX,EDX
		SHL EDX,2h
		XOR ECX,EDX
		MOV EDX,EAX
		MOV ESI,ECX
		SHR EDX,10h
		AND ESI,0FFFFh
		XOR EDX,ESI
		XOR ECX,EDX
		SHL EDX,10h
		XOR EAX,EDX
		MOV ESI,ECX
		MOV EDX,EAX
		AND ESI,0F0F0F0Fh
		SHR EDX,4h
		AND EDX,0F0F0F0Fh
		XOR EDX,ESI
		MOV ESI,EDX
		SHL ESI,4h
		XOR ESI,EAX
		//MOV EAX,DWORD PTR SS:[ESP+14h]
		XOR EDX,ECX

		//mov _eax, EAX
		mov _edx, EDX
		//mov _ecx, ECX
		mov _esi, ESI

		mov ESI, __esi
		mov ESP, __esp
	}

	*(uint32 *)(data) = gethe32((uint8 *)&_esi);
	*(uint32 *)(data + 4) = gethe32((uint8 *)&_edx);

	return;
}


bool ms_check_flags(const uint8 *data, int len)
{
	return (memcmp(data, ms_file_flags, 4) == 0);
}

bool ms_decompress(const uint8 *data, int len, CBuffer& buf)
{
	uint32 orilen = *(uint32 *)(data + 4);
	int status = ungzip((char *)(data + 8), len - 8, buf);

	if (status == Z_OK) {
		//orilen == buf.GetBufferLen()
		return true;
	}
	return false;
}

bool ms_decode(uint8 *raw_data, int raw_len)
{
	int block_count = raw_len / 8;
	for (int i = 0; i < block_count; i++) {
		ms_decode8(raw_data + i * 8);
	}
	return true;
}

int ms_text_parse(CBuffer& text_buf, core::TAMJSTRUCT** userlist)
{
	text_buf.WriteZeroByte();

	uint8 *text_data = text_buf.GetBuffer();
	//CHECK text_len text_buf.GetBufferLen
	uint32 text_len = *(uint32 *)(text_data);
	char *text = (char *)(text_data + 4);

	CBuffer userlist_buf;
	core::TAMJSTRUCT mj;
	uint32 count = 0;

	char *username, *password, *cookie, *mjstart, *mjend;
#ifdef NO_UTF8
	mjstart = text;
#else
	char *utf8_text = NULL;
	text_len = lo_C2Utf8(&utf8_text, text);
	if (!utf8_text) {
		return 0;
	}
	text_buf.SetBufferLink((PBYTE)utf8_text, text_len);
	mjstart = utf8_text;
#endif

	while (true) {
		memset(&mj, 0, sizeof(core::TAMJSTRUCT));

		mjend = strstr(mjstart, ")]");
		if (mjend) {
			mjend[0] = 0;
		} else {
			break;
		}

		username = strstr(mjstart, "(username:");
		password = strstr(mjstart, "(password:");
		cookie = strstr(mjstart, "(cookies:");
		if (!username || !password || !cookie) {
			mjstart = mjend;
			continue;
		}
		if (*(username - 1) == ')') {
			*(username - 1) = 0;
		}
		if (*(password - 1) == ')') {
			*(password - 1) = 0;
		}
		if (*(cookie - 1) == ')') {
			*(cookie - 1) = 0;
		}
		username += 10;
		password += 10;
		cookie += 9;

		mj.szUserName = username;
		mj.szCode = password;
		mj.szCookie = cookie;

		userlist_buf.Write((uint8 *)&mj, sizeof(core::TAMJSTRUCT));

		mjstart = mjend + 1;
		
		count++;
	}

	if (count > 0) {
		userlist_buf.SetDestoryFree(false);
		*userlist = (core::TAMJSTRUCT *)userlist_buf.GetBuffer();
	}

	return count;
}